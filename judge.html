<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>判定実行</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-client.js"></script>
</head>
<body>
    <div id="main-app" class="container" style="display:none;">
        </div>
    <script>
        let savedSubjects = [];
        const RULES = { /* ... */ }; // RULESオブジェクトは変更なし

        // ... 認証チェックとデータ読込 ...

        async function renderResultCard(majorName, result, judgment, percentage) {
            // ... カードのHTMLを生成 ...
            // ランキングと偏差値の取得をsupabase.rpc()に変更
            const { data, error } = await supabase.rpc('get_rank_and_deviation', {
                major_name: majorName
            });
            if (data) {
                // ... 取得したdataで順位・偏差値を表示 ...
            }
        }
    </script>
</body>
</html>
